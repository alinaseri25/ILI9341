/*
		Library: 			TFT 2.4 inch LCD - ILI9341
		Written by:  	Mohamed Yaqoob
		Date:				 	16/08/2016
		Description:	This is a library for the 2.4 inches TFT LCD arduino shield with the
									ILI9341 driver. It perform basic displaying operations such as printing
									colored text and numbers. In addition to some more advanced oprations
									including drawing geometrical objects like line, rectange, circle,
									triangle and more...
		References**:
									This was written by referring mainly to the datasheet of the ILI9341
									LCD driver and by re-using some open source Arduino libraries as the
									following:
									(1): The ILI9341 LCD driver datasheet: 
											 https://cdn-shop.adafruit.com/datasheets/ILI9341.pdf
									
									(2): SPFD5408 Adafruit Arduino library:
											 https://github.com/JoaoLopesF/SPFD5408
*/

/*

Some additional edits by Iman Hosseinzadeh i.hosseinzadeh@ut.ac.ir
*/

//(1): Header files
#include <stdbool.h>
#include <stdlib.h>
#include <stdio.h>


#include "STM_MY_TFT_ILI9341.h"
#include "string.h"

#ifndef pgm_read_byte
 #define pgm_read_byte(addr) (*(const unsigned char *)(addr))
#endif
#ifndef pgm_read_word
 #define pgm_read_word(addr) (*(const unsigned short *)(addr))
#endif
#ifndef pgm_read_dword
 #define pgm_read_dword(addr) (*(const unsigned long *)(addr))
#endif

// Pointers are a peculiar case...typically 16-bit on AVR boards,
// 32 bits elsewhere.  Try to accommodate both...

#if !defined(__INT_MAX__) || (__INT_MAX__ > 0xFFFF)
 #define pgm_read_pointer(addr) ((void *)pgm_read_dword(addr))
#else
 #define pgm_read_pointer(addr) ((void *)pgm_read_word(addr))
#endif

#ifndef min
#define min(a,b) (((a) < (b)) ? (a) : (b))
#endif

#ifndef _swap_int16_t
#define _swap_int16_t(a, b) { int16_t t = a; a = b; b = t; }
#endif


uint8_t _7snum40x72[] = {
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xFF, 0xFF, 0xFF, 0x0F, 0xFE, 0xFF, 0xFF, 0x01, 0xC0, 0xFF, 0xFF, 0xFF, 0x1F, 0xFF, 0xFF, 0xFF, 0x03, 0xE0, 0xFF, 0xFF, 0xFF, 0xBF, 0xFF, 0xFF, 0xFF, 0x07, 0xE0, 0xFF, 0xFF, 0xFF, 0xBF, 0xFF, 0xFF, 0xFF, 0x07, 0xCC, 0xFF, 0xFF, 0xFF, 0x1F, 0xFF, 0xFF, 0xFF, 0x33, 0x9E, 0xFF, 0xFF, 0xFF, 0x0F, 0xFE, 0xFF, 0xFF, 0x79, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0xFF, 0xFF, 0xFF, 0x0F, 0xFE, 0xFF, 0xFF, 0xFD, 0x9E, 0xFF, 0xFF, 0xFF, 0x1F, 0xFF, 0xFF, 0xFF, 0x7B, 0xCC, 0xFF, 0xFF, 0xFF, 0xBF, 0xFF, 0xFF, 0xFF, 0x37, 0xC0, 0xFF, 0xFF, 0xFF, 0xBF, 0xFF, 0xFF, 0xFF, 0x07, 0x80, 0xFF, 0xFF, 0xFF, 0x1F, 0xFF, 0xFF, 0xFF, 0x03, 0x00, 0xFF, 0xFF, 0xFF, 0x0F, 0xFE, 0xFF, 0xFF, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char 0
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0x0F, 0xFE, 0xFF, 0xFF, 0x01, 0x80, 0xFF, 0xFF, 0xFF, 0x1F, 0xFF, 0xFF, 0xFF, 0x03, 0xC0, 0xFF, 0xFF, 0xFF, 0xBF, 0xFF, 0xFF, 0xFF, 0x07, 0xC0, 0xFF, 0xFF, 0xFF, 0xBF, 0xFF, 0xFF, 0xFF, 0x07, 0x80, 0xFF, 0xFF, 0xFF, 0x1F, 0xFF, 0xFF, 0xFF, 0x03, 0x00, 0xFF, 0xFF, 0xFF, 0x0F, 0xFE, 0xFF, 0xFF, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char 1
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFE, 0xFF, 0xFF, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0x03, 0x00, 0x00, 0x00, 0x00, 0x80, 0xFF, 0xFF, 0xFF, 0x07, 0x00, 0x00, 0x00, 0x00, 0x80, 0xFF, 0xFF, 0xFF, 0x07, 0x0C, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0x33, 0x1E, 0x00, 0x00, 0x00, 0x60, 0xFE, 0xFF, 0xFF, 0x79, 0x3F, 0x00, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0xFF, 0xFF, 0xFF, 0x6F, 0x00, 0x00, 0x00, 0xFC, 0x9E, 0xFF, 0xFF, 0xFF, 0x1F, 0x00, 0x00, 0x00, 0x78, 0xCC, 0xFF, 0xFF, 0xFF, 0x3F, 0x00, 0x00, 0x00, 0x30, 0xC0, 0xFF, 0xFF, 0xFF, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x80, 0xFF, 0xFF, 0xFF, 0x1F, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char 2
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x1E, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 0x78, 0x3F, 0x00, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0xFF, 0xFF, 0xFF, 0x6F, 0xFE, 0xFF, 0xFF, 0xFD, 0x9E, 0xFF, 0xFF, 0xFF, 0x1F, 0xFF, 0xFF, 0xFF, 0x7B, 0xCC, 0xFF, 0xFF, 0xFF, 0xBF, 0xFF, 0xFF, 0xFF, 0x37, 0xC0, 0xFF, 0xFF, 0xFF, 0xBF, 0xFF, 0xFF, 0xFF, 0x07, 0x80, 0xFF, 0xFF, 0xFF, 0x1F, 0xFF, 0xFF, 0xFF, 0x03, 0x00, 0xFF, 0xFF, 0xFF, 0x0F, 0xFE, 0xFF, 0xFF, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char 3
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xFF, 0xFF, 0xFF, 0x0F, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xFF, 0xFF, 0xFF, 0x1F, 0x00, 0x00, 0x00, 0x00, 0xE0, 0xFF, 0xFF, 0xFF, 0x3F, 0x00, 0x00, 0x00, 0x00, 0xE0, 0xFF, 0xFF, 0xFF, 0x3F, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xFF, 0xFF, 0xFF, 0x1F, 0x00, 0x00, 0x00, 0x00, 0x80, 0xFF, 0xFF, 0xFF, 0x6F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0x6F, 0xFE, 0xFF, 0xFF, 0x01, 0x80, 0xFF, 0xFF, 0xFF, 0x1F, 0xFF, 0xFF, 0xFF, 0x03, 0xC0, 0xFF, 0xFF, 0xFF, 0xBF, 0xFF, 0xFF, 0xFF, 0x07, 0xC0, 0xFF, 0xFF, 0xFF, 0xBF, 0xFF, 0xFF, 0xFF, 0x07, 0x80, 0xFF, 0xFF, 0xFF, 0x1F, 0xFF, 0xFF, 0xFF, 0x03, 0x00, 0xFF, 0xFF, 0xFF, 0x0F, 0xFE, 0xFF, 0xFF, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char 4
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xFF, 0xFF, 0xFF, 0x0F, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xFF, 0xFF, 0xFF, 0x1F, 0x00, 0x00, 0x00, 0x00, 0xE0, 0xFF, 0xFF, 0xFF, 0x3F, 0x00, 0x00, 0x00, 0x00, 0xE0, 0xFF, 0xFF, 0xFF, 0x3F, 0x00, 0x00, 0x00, 0x00, 0xCC, 0xFF, 0xFF, 0xFF, 0x1F, 0x00, 0x00, 0x00, 0x30, 0x9E, 0xFF, 0xFF, 0xFF, 0x6F, 0x00, 0x00, 0x00, 0x78, 0x3F, 0x00, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0x60, 0xFE, 0xFF, 0xFF, 0xFD, 0x1E, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0x7B, 0x0C, 0x00, 0x00, 0x00, 0x80, 0xFF, 0xFF, 0xFF, 0x37, 0x00, 0x00, 0x00, 0x00, 0x80, 0xFF, 0xFF, 0xFF, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFE, 0xFF, 0xFF, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char 5
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xFF, 0xFF, 0xFF, 0x0F, 0xFE, 0xFF, 0xFF, 0x01, 0xC0, 0xFF, 0xFF, 0xFF, 0x1F, 0xFF, 0xFF, 0xFF, 0x03, 0xE0, 0xFF, 0xFF, 0xFF, 0xBF, 0xFF, 0xFF, 0xFF, 0x07, 0xE0, 0xFF, 0xFF, 0xFF, 0xBF, 0xFF, 0xFF, 0xFF, 0x07, 0xCC, 0xFF, 0xFF, 0xFF, 0x1F, 0xFF, 0xFF, 0xFF, 0x33, 0x9E, 0xFF, 0xFF, 0xFF, 0x6F, 0xFE, 0xFF, 0xFF, 0x79, 0x3F, 0x00, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0x60, 0xFE, 0xFF, 0xFF, 0xFD, 0x1E, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0x7B, 0x0C, 0x00, 0x00, 0x00, 0x80, 0xFF, 0xFF, 0xFF, 0x37, 0x00, 0x00, 0x00, 0x00, 0x80, 0xFF, 0xFF, 0xFF, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFE, 0xFF, 0xFF, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char 6
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0xFF, 0xFF, 0xFF, 0x0F, 0xFE, 0xFF, 0xFF, 0x01, 0x9E, 0xFF, 0xFF, 0xFF, 0x1F, 0xFF, 0xFF, 0xFF, 0x03, 0xCC, 0xFF, 0xFF, 0xFF, 0xBF, 0xFF, 0xFF, 0xFF, 0x07, 0xC0, 0xFF, 0xFF, 0xFF, 0xBF, 0xFF, 0xFF, 0xFF, 0x07, 0x80, 0xFF, 0xFF, 0xFF, 0x1F, 0xFF, 0xFF, 0xFF, 0x03, 0x00, 0xFF, 0xFF, 0xFF, 0x0F, 0xFE, 0xFF, 0xFF, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char 7
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xFF, 0xFF, 0xFF, 0x0F, 0xFE, 0xFF, 0xFF, 0x01, 0xC0, 0xFF, 0xFF, 0xFF, 0x1F, 0xFF, 0xFF, 0xFF, 0x03, 0xE0, 0xFF, 0xFF, 0xFF, 0xBF, 0xFF, 0xFF, 0xFF, 0x07, 0xE0, 0xFF, 0xFF, 0xFF, 0xBF, 0xFF, 0xFF, 0xFF, 0x07, 0xCC, 0xFF, 0xFF, 0xFF, 0x1F, 0xFF, 0xFF, 0xFF, 0x33, 0x9E, 0xFF, 0xFF, 0xFF, 0x6F, 0xFE, 0xFF, 0xFF, 0x79, 0x3F, 0x00, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0xFF, 0xFF, 0xFF, 0x6F, 0xFE, 0xFF, 0xFF, 0xFD, 0x9E, 0xFF, 0xFF, 0xFF, 0x1F, 0xFF, 0xFF, 0xFF, 0x7B, 0xCC, 0xFF, 0xFF, 0xFF, 0xBF, 0xFF, 0xFF, 0xFF, 0x37, 0xC0, 0xFF, 0xFF, 0xFF, 0xBF, 0xFF, 0xFF, 0xFF, 0x07, 0x80, 0xFF, 0xFF, 0xFF, 0x1F, 0xFF, 0xFF, 0xFF, 0x03, 0x00, 0xFF, 0xFF, 0xFF, 0x0F, 0xFE, 0xFF, 0xFF, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  // Code for char 8
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xFF, 0xFF, 0xFF, 0x0F, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xFF, 0xFF, 0xFF, 0x1F, 0x00, 0x00, 0x00, 0x00, 0xE0, 0xFF, 0xFF, 0xFF, 0x3F, 0x00, 0x00, 0x00, 0x00, 0xE0, 0xFF, 0xFF, 0xFF, 0x3F, 0x00, 0x00, 0x00, 0x00, 0xCC, 0xFF, 0xFF, 0xFF, 0x1F, 0x00, 0x00, 0x00, 0x30, 0x9E, 0xFF, 0xFF, 0xFF, 0x6F, 0x00, 0x00, 0x00, 0x78, 0x3F, 0x00, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF8, 0x01, 0x00, 0x00, 0xFC, 0x3F, 0x00, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x00, 0xFC, 0x3F, 0xFF, 0xFF, 0xFF, 0x6F, 0xFE, 0xFF, 0xFF, 0xFD, 0x9E, 0xFF, 0xFF, 0xFF, 0x1F, 0xFF, 0xFF, 0xFF, 0x7B, 0xCC, 0xFF, 0xFF, 0xFF, 0xBF, 0xFF, 0xFF, 0xFF, 0x37, 0xC0, 0xFF, 0xFF, 0xFF, 0xBF, 0xFF, 0xFF, 0xFF, 0x07, 0x80, 0xFF, 0xFF, 0xFF, 0x1F, 0xFF, 0xFF, 0xFF, 0x03, 0x00, 0xFF, 0xFF, 0xFF, 0x0F, 0xFE, 0xFF, 0xFF, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00   // Code for char 9
        };
uint8_t FONT8x15[97][15] =
{

//0x08,0x0F,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // columns, rows, nbytes
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x18,0x3C,0x3C,0x3C,0x18,0x18,0x18,0x00,0x18,0x18,0x00,0x00,0x00, // !
0x00,0x63,0x63,0x63,0x22,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // "
0x00,0x00,0x00,0x36,0x36,0x7F,0x36,0x36,0x36,0x7F,0x36,0x36,0x00,0x00,0x00, // #
0x0C,0x0C,0x3E,0x63,0x61,0x60,0x3E,0x03,0x03,0x43,0x63,0x3E,0x0C,0x0C,0x00, // $
0x00,0x00,0x00,0x00,0x00,0x61,0x63,0x06,0x0C,0x18,0x33,0x63,0x00,0x00,0x00, // %
0x00,0x00,0x00,0x1C,0x36,0x36,0x1C,0x3B,0x6E,0x66,0x66,0x3B,0x00,0x00,0x00, // &
0x00,0x30,0x30,0x30,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // '
0x00,0x00,0x0C,0x18,0x18,0x30,0x30,0x30,0x30,0x18,0x18,0x0C,0x00,0x00,0x00, // (
0x00,0x00,0x18,0x0C,0x0C,0x06,0x06,0x06,0x06,0x0C,0x0C,0x18,0x00,0x00,0x00, // )
0x00,0x00,0x00,0x00,0x42,0x66,0x3C,0xFF,0x3C,0x66,0x42,0x00,0x00,0x00,0x00, // *
0x00,0x00,0x00,0x00,0x18,0x18,0x18,0xFF,0x18,0x18,0x18,0x00,0x00,0x00,0x00, // +
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x18,0x30,0x00, // ,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // -
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00, // .
0x00,0x00,0x01,0x03,0x07,0x0E,0x1C,0x38,0x70,0xE0,0xC0,0x80,0x00,0x00,0x00, // / (forward slash)
0x00,0x00,0x3E,0x63,0x63,0x63,0x67,0x6B,0x73,0x63,0x63,0x3E,0x00,0x00,0x00, // 0 0x30
0x00,0x00,0x0C,0x1C,0x3C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x3F,0x00,0x00,0x00, // 1
0x00,0x00,0x3E,0x63,0x03,0x06,0x0C,0x18,0x30,0x61,0x63,0x7F,0x00,0x00,0x00, // 2
0x00,0x00,0x3E,0x63,0x03,0x03,0x1E,0x03,0x03,0x03,0x63,0x3E,0x00,0x00,0x00, // 3
0x00,0x00,0x06,0x0E,0x1E,0x36,0x66,0x66,0x7F,0x06,0x06,0x0F,0x00,0x00,0x00, // 4
0x00,0x00,0x7F,0x60,0x60,0x60,0x7E,0x03,0x03,0x63,0x73,0x3E,0x00,0x00,0x00, // 5
0x00,0x00,0x1C,0x30,0x60,0x60,0x7E,0x63,0x63,0x63,0x63,0x3E,0x00,0x00,0x00, // 6
0x00,0x00,0x7F,0x63,0x03,0x06,0x06,0x0C,0x0C,0x18,0x18,0x18,0x00,0x00,0x00, // 7
0x00,0x00,0x3E,0x63,0x63,0x63,0x3E,0x63,0x63,0x63,0x63,0x3E,0x00,0x00,0x00, // 8
0x00,0x00,0x3E,0x63,0x63,0x63,0x63,0x3F,0x03,0x03,0x06,0x3C,0x00,0x00,0x00, // 9
0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00, // :
0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00,0x18,0x18,0x18,0x30,0x00, // ;
0x00,0x00,0x00,0x06,0x0C,0x18,0x30,0x60,0x30,0x18,0x0C,0x06,0x00,0x00,0x00, // <
0x00,0x00,0x00,0x00,0x00,0x00,0x7E,0x00,0x00,0x7E,0x00,0x00,0x00,0x00,0x00, // =
0x00,0x00,0x00,0x60,0x30,0x18,0x0C,0x06,0x0C,0x18,0x30,0x60,0x00,0x00,0x00, // >
0x00,0x00,0x3E,0x63,0x63,0x06,0x0C,0x0C,0x0C,0x00,0x0C,0x0C,0x00,0x00,0x00, // ?
0x00,0x00,0x3E,0x63,0x63,0x6F,0x6B,0x6B,0x6E,0x60,0x60,0x3E,0x00,0x00,0x00, // @ 0x40
0x00,0x00,0x08,0x1C,0x36,0x63,0x63,0x63,0x7F,0x63,0x63,0x63,0x00,0x00,0x00, // A
0x00,0x00,0x7E,0x33,0x33,0x33,0x3E,0x33,0x33,0x33,0x33,0x7E,0x00,0x00,0x00, // B
0x00,0x00,0x1E,0x33,0x61,0x60,0x60,0x60,0x60,0x61,0x33,0x1E,0x00,0x00,0x00, // C
0x00,0x00,0x7C,0x36,0x33,0x33,0x33,0x33,0x33,0x33,0x36,0x7C,0x00,0x00,0x00, // D
0x00,0x00,0x7F,0x33,0x31,0x34,0x3C,0x34,0x30,0x31,0x33,0x7F,0x00,0x00,0x00, // E
0x00,0x00,0x7F,0x33,0x31,0x34,0x3C,0x34,0x30,0x30,0x30,0x78,0x00,0x00,0x00, // F
0x00,0x00,0x1E,0x33,0x61,0x60,0x60,0x6F,0x63,0x63,0x37,0x1D,0x00,0x00,0x00, // G
0x00,0x00,0x63,0x63,0x63,0x63,0x7F,0x63,0x63,0x63,0x63,0x63,0x00,0x00,0x00, // H
0x00,0x00,0x3C,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x3C,0x00,0x00,0x00, // I
0x00,0x00,0x0F,0x06,0x06,0x06,0x06,0x06,0x06,0x66,0x66,0x3C,0x00,0x00,0x00, // J
0x00,0x00,0x73,0x33,0x36,0x36,0x3C,0x36,0x36,0x33,0x33,0x73,0x00,0x00,0x00, // K
0x00,0x00,0x78,0x30,0x30,0x30,0x30,0x30,0x30,0x31,0x33,0x7F,0x00,0x00,0x00, // L
0x00,0x00,0x63,0x77,0x7F,0x6B,0x63,0x63,0x63,0x63,0x63,0x63,0x00,0x00,0x00, // M
0x00,0x00,0x63,0x63,0x73,0x7B,0x7F,0x6F,0x67,0x63,0x63,0x63,0x00,0x00,0x00, // N
0x00,0x00,0x1C,0x36,0x63,0x63,0x63,0x63,0x63,0x63,0x36,0x1C,0x00,0x00,0x00, // O
0x00,0x00,0x7E,0x33,0x33,0x33,0x3E,0x30,0x30,0x30,0x30,0x78,0x00,0x00,0x00, // P 0x50
0x00,0x00,0x3E,0x63,0x63,0x63,0x63,0x63,0x63,0x6B,0x6F,0x3E,0x06,0x07,0x00, // Q
0x00,0x00,0x7E,0x33,0x33,0x33,0x3E,0x36,0x36,0x33,0x33,0x73,0x00,0x00,0x00, // R
0x00,0x00,0x3E,0x63,0x63,0x30,0x1C,0x06,0x03,0x63,0x63,0x3E,0x00,0x00,0x00, // S
0x00,0x00,0xFF,0xDB,0x99,0x18,0x18,0x18,0x18,0x18,0x18,0x3C,0x00,0x00,0x00, // T
0x00,0x00,0x63,0x63,0x63,0x63,0x63,0x63,0x63,0x63,0x63,0x3E,0x00,0x00,0x00, // U
0x00,0x00,0x63,0x63,0x63,0x63,0x63,0x63,0x63,0x36,0x1C,0x08,0x00,0x00,0x00, // V
0x00,0x00,0x63,0x63,0x63,0x63,0x63,0x6B,0x6B,0x7F,0x36,0x36,0x00,0x00,0x00, // W
0x00,0x00,0xC3,0xC3,0x66,0x3C,0x18,0x18,0x3C,0x66,0xC3,0xC3,0x00,0x00,0x00, // X
0x00,0x00,0xC3,0xC3,0xC3,0x66,0x3C,0x18,0x18,0x18,0x18,0x3C,0x00,0x00,0x00, // Y
0x00,0x00,0x7F,0x63,0x43,0x06,0x0C,0x18,0x30,0x61,0x63,0x7F,0x00,0x00,0x00, // Z
0x00,0x00,0x3C,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x3C,0x00,0x00,0x00, // [
0x00,0x00,0x80,0xC0,0xE0,0x70,0x38,0x1C,0x0E,0x07,0x03,0x01,0x00,0x00,0x00, // \ (back slash)
0x00,0x00,0x3C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x3C,0x00,0x00,0x00, // ]
0x08,0x1C,0x36,0x63,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // ^
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00, // _
0x18,0x18,0x0C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // ` 0x60
0x00,0x00,0x00,0x00,0x00,0x3C,0x46,0x06,0x3E,0x66,0x66,0x3B,0x00,0x00,0x00, // a
0x00,0x00,0x70,0x30,0x30,0x3C,0x36,0x33,0x33,0x33,0x33,0x6E,0x00,0x00,0x00, // b
0x00,0x00,0x00,0x00,0x00,0x3E,0x63,0x60,0x60,0x60,0x63,0x3E,0x00,0x00,0x00, // c
0x00,0x00,0x0E,0x06,0x06,0x1E,0x36,0x66,0x66,0x66,0x66,0x3B,0x00,0x00,0x00, // d
0x00,0x00,0x00,0x00,0x00,0x3E,0x63,0x63,0x7E,0x60,0x63,0x3E,0x00,0x00,0x00, // e
0x00,0x00,0x1C,0x36,0x32,0x30,0x7C,0x30,0x30,0x30,0x30,0x78,0x00,0x00,0x00, // f
0x00,0x00,0x00,0x00,0x00,0x3B,0x66,0x66,0x66,0x66,0x3E,0x06,0x66,0x3C,0x00, // g
0x00,0x00,0x70,0x30,0x30,0x36,0x3B,0x33,0x33,0x33,0x33,0x73,0x00,0x00,0x00, // h
0x00,0x00,0x0C,0x0C,0x00,0x1C,0x0C,0x0C,0x0C,0x0C,0x0C,0x1E,0x00,0x00,0x00, // i
0x00,0x00,0x06,0x06,0x00,0x0E,0x06,0x06,0x06,0x06,0x06,0x66,0x66,0x3C,0x00, // j
0x00,0x00,0x70,0x30,0x30,0x33,0x33,0x36,0x3C,0x36,0x33,0x73,0x00,0x00,0x00, // k
0x00,0x00,0x1C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x1E,0x00,0x00,0x00, // l
0x00,0x00,0x00,0x00,0x00,0x6E,0x7F,0x6B,0x6B,0x6B,0x6B,0x6B,0x00,0x00,0x00, // m
0x00,0x00,0x00,0x00,0x00,0x6E,0x33,0x33,0x33,0x33,0x33,0x33,0x00,0x00,0x00, // n
0x00,0x00,0x00,0x00,0x00,0x3E,0x63,0x63,0x63,0x63,0x63,0x3E,0x00,0x00,0x00, // o
0x00,0x00,0x00,0x00,0x00,0x6E,0x33,0x33,0x33,0x33,0x3E,0x30,0x30,0x78,0x00, // p 0x70
0x00,0x00,0x00,0x00,0x00,0x3B,0x66,0x66,0x66,0x66,0x3E,0x06,0x06,0x0F,0x00, // q
0x00,0x00,0x00,0x00,0x00,0x6E,0x3B,0x33,0x30,0x30,0x30,0x78,0x00,0x00,0x00, // r
0x00,0x00,0x00,0x00,0x00,0x3E,0x63,0x38,0x0E,0x03,0x63,0x3E,0x00,0x00,0x00, // s
0x00,0x00,0x08,0x18,0x18,0x7E,0x18,0x18,0x18,0x18,0x1B,0x0E,0x00,0x00,0x00, // t
0x00,0x00,0x00,0x00,0x00,0x66,0x66,0x66,0x66,0x66,0x66,0x3B,0x00,0x00,0x00, // u
0x00,0x00,0x00,0x00,0x00,0x63,0x63,0x36,0x36,0x1C,0x1C,0x08,0x00,0x00,0x00, // v
0x00,0x00,0x00,0x00,0x00,0x63,0x63,0x63,0x6B,0x6B,0x7F,0x36,0x00,0x00,0x00, // w
0x00,0x00,0x00,0x00,0x00,0x63,0x36,0x1C,0x1C,0x1C,0x36,0x63,0x00,0x00,0x00, // x
0x00,0x00,0x00,0x00,0x00,0x63,0x63,0x63,0x63,0x63,0x3F,0x03,0x06,0x3C,0x00, // y
0x00,0x00,0x00,0x00,0x00,0x7F,0x66,0x0C,0x18,0x30,0x63,0x7F,0x00,0x00,0x00, // z
0x00,0x00,0x0E,0x18,0x18,0x18,0x70,0x18,0x18,0x18,0x18,0x0E,0x00,0x00,0x00, // {
0x00,0x00,0x18,0x18,0x18,0x18,0x18,0x00,0x18,0x18,0x18,0x18,0x18,0x00,0x00, // |
0x00,0x00,0x70,0x18,0x18,0x18,0x0E,0x18,0x18,0x18,0x18,0x70,0x00,0x00,0x00, // }
0x00,0x00,0x3B,0x6E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // ~
0x00,0x70,0xD8,0xD8,0x70,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

#define CHAR_W 8
#define CHAR_H 15

#define CH_W 20
#define CH_H 64


//(2): varaible declarations
//static uint8_t iData[5];
uint16_t TFTWIDTH  = 240;
uint16_t TFTHEIGHT  = 320;
uint16_t temp  = 0;
static uint8_t rotationNum=1;
static bool _cp437    = false;

//(3): Private functions definition
//***************************************************************************
void TFT_LCD_WR(bool state)
{
	HAL_GPIO_WritePin(LCD_WR_GPIO_Port, LCD_WR_Pin, (GPIO_PinState)state);
}
//***************************************************************************
static void TFT_LCD_RD(bool state)
{
	HAL_GPIO_WritePin(LCD_RD_GPIO_Port, LCD_RD_Pin, (GPIO_PinState)state);
}
//***************************************************************************
static void TFT_LCD_RS(bool state)
{
	HAL_GPIO_WritePin(LCD_RS_GPIO_Port, LCD_RS_Pin, (GPIO_PinState)state);
}
//***************************************************************************
static void TFT_LCD_CS(bool state)
{
	HAL_GPIO_WritePin(LCD_CS_GPIO_Port, LCD_CS_Pin, (GPIO_PinState)state);
}
//***************************************************************************
 void TFT_LCD_RST(bool state)
{
	HAL_GPIO_WritePin(LCD_RST_GPIO_Port, LCD_RST_Pin, (GPIO_PinState)state);
}
//***************************************************************************
static void GPIO_read(void)
{
	GPIO_InitTypeDef GPIO_InitStruct;

	GPIO_InitStruct.Pin = LCD_D0_Pin|LCD_D1_Pin|LCD_D2_Pin|LCD_D3_Pin|LCD_D4_Pin|LCD_D5_Pin|LCD_D6_Pin 
						  |LCD_D7_Pin;
	GPIO_InitStruct.Mode = GPIO_MODE_INPUT;
	GPIO_InitStruct.Pull = GPIO_NOPULL;
	GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_HIGH;
	HAL_GPIO_Init(GPIOA, &GPIO_InitStruct);
}
//***************************************************************************
static void GPIO_write(void)
{
	GPIO_InitTypeDef GPIO_InitStruct;

	GPIO_InitStruct.Pin = LCD_D0_Pin|LCD_D1_Pin|LCD_D2_Pin|LCD_D3_Pin|LCD_D4_Pin|LCD_D5_Pin|LCD_D6_Pin 
						  |LCD_D7_Pin;
	GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
	GPIO_InitStruct.Pull = GPIO_NOPULL;
	GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_HIGH;
	HAL_GPIO_Init(GPIOA, &GPIO_InitStruct);
}
//***************************************************************************
static void writeRegister8(uint8_t Reg, uint8_t data)
{
	TFT_LCD_RS(false);
	write8(Reg);
	TFT_LCD_RS(true);
	write8(data);
}
//***************************************************************************
void write8(uint8_t data)
{
	TFT_LCD_CS(false);
	TFT_LCD_RD(true);
	
	PORT_D0->ODR &= ~(LCD_D0_Pin);
	PORT_D1->ODR &= ~(LCD_D1_Pin);
	PORT_D2->ODR &= ~(LCD_D2_Pin);
	PORT_D3->ODR &= ~(LCD_D3_Pin);
	PORT_D4->ODR &= ~(LCD_D4_Pin);
	PORT_D5->ODR &= ~(LCD_D5_Pin);
	PORT_D6->ODR &= ~(LCD_D6_Pin);
	PORT_D7->ODR &= ~(LCD_D7_Pin);
	

	TFT_LCD_WR(false);
	HAL_GPIO_WritePin(PORT_D0, LCD_D0_Pin, (GPIO_PinState)((data>>0) & 1UL));
	HAL_GPIO_WritePin(PORT_D1, LCD_D1_Pin, (GPIO_PinState)((data>>1) & 1UL));
	HAL_GPIO_WritePin(PORT_D2, LCD_D2_Pin, (GPIO_PinState)((data>>2) & 1UL));
	HAL_GPIO_WritePin(PORT_D3, LCD_D3_Pin, (GPIO_PinState)((data>>3) & 1UL));
	
	HAL_GPIO_WritePin(PORT_D4, LCD_D4_Pin, (GPIO_PinState)((data>>4) & 1UL));
	HAL_GPIO_WritePin(PORT_D5, LCD_D5_Pin, (GPIO_PinState)((data>>5) & 1UL));
	HAL_GPIO_WritePin(PORT_D6, LCD_D6_Pin, (GPIO_PinState)((data>>6) & 1UL));
	HAL_GPIO_WritePin(PORT_D7, LCD_D7_Pin, (GPIO_PinState)((data>>7) & 1UL));
	
	TFT_LCD_WR(true);
	TFT_LCD_CS(true);
}	
//***************************************************************************
static void write8_fast(uint8_t data[2], uint32_t size)
{
	TFT_LCD_CS(false);
	TFT_LCD_RD(true);
	
	PORT_D0->ODR &= ~(LCD_D0_Pin);
	PORT_D1->ODR &= ~(LCD_D1_Pin);
	PORT_D2->ODR &= ~(LCD_D2_Pin);
	PORT_D3->ODR &= ~(LCD_D3_Pin);
	PORT_D4->ODR &= ~(LCD_D4_Pin);
	PORT_D5->ODR &= ~(LCD_D5_Pin);
	PORT_D6->ODR &= ~(LCD_D6_Pin);
	PORT_D7->ODR &= ~(LCD_D7_Pin);
	

	for(uint32_t k=0; k<size;k++)
	{
	TFT_LCD_WR(false);
	HAL_GPIO_WritePin(PORT_D0, LCD_D0_Pin, (GPIO_PinState)((data[0]>>0) & 1UL));
	HAL_GPIO_WritePin(PORT_D1, LCD_D1_Pin, (GPIO_PinState)((data[0]>>1) & 1UL));
	HAL_GPIO_WritePin(PORT_D2, LCD_D2_Pin, (GPIO_PinState)((data[0]>>2) & 1UL));
	HAL_GPIO_WritePin(PORT_D3, LCD_D3_Pin, (GPIO_PinState)((data[0]>>3) & 1UL));
	
	HAL_GPIO_WritePin(PORT_D4, LCD_D4_Pin, (GPIO_PinState)((data[0]>>4) & 1UL));
	HAL_GPIO_WritePin(PORT_D5, LCD_D5_Pin, (GPIO_PinState)((data[0]>>5) & 1UL));
	HAL_GPIO_WritePin(PORT_D6, LCD_D6_Pin, (GPIO_PinState)((data[0]>>6) & 1UL));
	HAL_GPIO_WritePin(PORT_D7, LCD_D7_Pin, (GPIO_PinState)((data[0]>>7) & 1UL));
	TFT_LCD_WR(true);

	TFT_LCD_WR(false);
	HAL_GPIO_WritePin(PORT_D0, LCD_D0_Pin, (GPIO_PinState)((data[1]>>0) & 1UL));
	HAL_GPIO_WritePin(PORT_D1, LCD_D1_Pin, (GPIO_PinState)((data[1]>>1) & 1UL));
	HAL_GPIO_WritePin(PORT_D2, LCD_D2_Pin, (GPIO_PinState)((data[1]>>2) & 1UL));
	HAL_GPIO_WritePin(PORT_D3, LCD_D3_Pin, (GPIO_PinState)((data[1]>>3) & 1UL));
	
	HAL_GPIO_WritePin(PORT_D4, LCD_D4_Pin, (GPIO_PinState)((data[1]>>4) & 1UL));
	HAL_GPIO_WritePin(PORT_D5, LCD_D5_Pin, (GPIO_PinState)((data[1]>>5) & 1UL));
	HAL_GPIO_WritePin(PORT_D6, LCD_D6_Pin, (GPIO_PinState)((data[1]>>6) & 1UL));
	HAL_GPIO_WritePin(PORT_D7, LCD_D7_Pin, (GPIO_PinState)((data[1]>>7) & 1UL));
	TFT_LCD_WR(true);
	}
	TFT_LCD_CS(true);
}
//***************************************************************************
static void writeRegister16(uint8_t Reg, uint8_t data[2])
{
	TFT_LCD_RS(false);
	write8(Reg);
	TFT_LCD_RS(true);
	write8_fast(data, 2);
	//write8(data[0]);
//	write8(data[1]);
}

static void writeRegisterN(uint8_t Reg, uint8_t *data,uint8_t N)
{
	TFT_LCD_RS(false);
	write8(Reg);
	TFT_LCD_RS(true);
	for (uint8_t j=0;j<N;j++)
	{
		write8(data[j]);
	}
}
//***************************************************************************
static void writeRegister32(uint8_t Reg, uint32_t data)
{
	//uint8_t data_8;
	TFT_LCD_RS(false);
	write8(Reg);
	TFT_LCD_RS(true);
	//data_8 = 0xFF&(data>>24);
	write8(0xFF&(data>>24));
	write8(0xFF&(data>>16));
	write8(0xFF&(data>>8));
	write8(0xFF&(data));
}
//***************************************************************************
static void setAddrWindow(uint16_t x1, uint16_t y1, uint16_t x2, uint16_t y2)
{
	TFT_LCD_CS(false);
	uint32_t data_32;
	data_32 = (x1<<16)|(x2);
	writeRegister32(ILI9341_COLADDRSET, data_32);
	data_32 = (y1<<16)|(y2);
	writeRegister32(ILI9341_PAGEADDRSET, data_32);
	TFT_LCD_CS(true);
}
//***************************************************************************
 void readRegister8(uint8_t Reg, uint8_t size, uint8_t *dataRet)
{
	uint8_t data_sub;
	TFT_LCD_RS(false);
	write8(Reg);
	TFT_LCD_CS(false);
	GPIO_read();
	TFT_LCD_RS(true);
	TFT_LCD_WR(true);
	for(uint8_t j=0; j<size;j++)
	{
		TFT_LCD_RD(false);
		for(uint32_t i; i<100;i++);
		data_sub  = ((1UL&HAL_GPIO_ReadPin(PORT_D0, LCD_D0_Pin))<<0);
		data_sub |= ((1UL&HAL_GPIO_ReadPin(PORT_D1, LCD_D1_Pin))<<1);
		data_sub |= ((1UL&HAL_GPIO_ReadPin(PORT_D2, LCD_D2_Pin))<<2);
		data_sub |= ((1UL&HAL_GPIO_ReadPin(PORT_D3, LCD_D3_Pin))<<3);
		
		data_sub |= ((1UL&HAL_GPIO_ReadPin(PORT_D4, LCD_D4_Pin))<<4);
		data_sub |= ((1UL&HAL_GPIO_ReadPin(PORT_D5, LCD_D5_Pin))<<5);
		data_sub |= ((1UL&HAL_GPIO_ReadPin(PORT_D6, LCD_D6_Pin))<<6);
		data_sub |= ((1UL&HAL_GPIO_ReadPin(PORT_D7, LCD_D7_Pin))<<7);
		TFT_LCD_RD(true);
		dataRet[j] = data_sub;
	}
	TFT_LCD_CS(true);
	GPIO_write();
}
//***************************************************************************
//***************************************************************************
//(4): Public functions definition
void ILI9341_Init(void)
{
	GPIO_InitTypeDef GPIO_InitStruct;

	/* GPIO Ports Clock Enable */
 
	
	// SET FOR CLOCK INIT
//	__HAL_RCC_GPIOB_CLK_ENABLE();
//	__HAL_RCC_GPIOE_CLK_ENABLE();
//	__HAL_RCC_GPIOG_CLK_ENABLE();
//	__HAL_RCC_GPIOF_CLK_ENABLE();
//	__HAL_RCC_GPIOG_CLK_ENABLE();
//	__HAL_RCC_GPIOF_CLK_ENABLE();

	
	/*Configure GPIO pin Output Level */
	//(1): Reset all pins
	HAL_GPIO_WritePin(LCD_WR_GPIO_Port, LCD_WR_Pin, GPIO_PIN_RESET);
	HAL_GPIO_WritePin(LCD_RS_GPIO_Port, LCD_RS_Pin, GPIO_PIN_RESET);
	HAL_GPIO_WritePin(LCD_CS_GPIO_Port, LCD_CS_Pin, GPIO_PIN_RESET);
	HAL_GPIO_WritePin(LCD_RST_GPIO_Port, LCD_RST_Pin, GPIO_PIN_RESET);
	HAL_GPIO_WritePin(LCD_RD_GPIO_Port, LCD_RD_Pin, GPIO_PIN_RESET);
	
	PORT_D0->ODR &= ~(LCD_D0_Pin);
	PORT_D1->ODR &= ~(LCD_D1_Pin);
	PORT_D2->ODR &= ~(LCD_D2_Pin);
	PORT_D3->ODR &= ~(LCD_D3_Pin);
	PORT_D4->ODR &= ~(LCD_D4_Pin);
	PORT_D5->ODR &= ~(LCD_D5_Pin);
	PORT_D6->ODR &= ~(LCD_D6_Pin);
	PORT_D7->ODR &= ~(LCD_D7_Pin);
	
//	
//	HAL_GPIO_WritePin(PORT_D1_2, LCD_D1_Pin|LCD_D2_Pin, GPIO_PIN_RESET);
//	HAL_GPIO_WritePin(PORT_Detc, LCD_D0_Pin|LCD_D4_Pin|LCD_D5_Pin|LCD_D6_Pin|LCD_D7_Pin|LCD_D3_Pin, GPIO_PIN_RESET);

  /*Configure GPIO pins : LCD_WR_Pin LCD_RS_Pin LCD_CS_Pin LCD_RST_Pin 
                           LCD_D0_Pin LCD_D1_Pin LCD_D2_Pin LCD_D3_Pin */

	GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
	GPIO_InitStruct.Pull = GPIO_NOPULL;
	GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_HIGH;
	
	GPIO_InitStruct.Pin = LCD_D0_Pin;
	HAL_GPIO_Init(PORT_D0, &GPIO_InitStruct);
	
	GPIO_InitStruct.Pin = LCD_D1_Pin;
	HAL_GPIO_Init(PORT_D1, &GPIO_InitStruct);

	GPIO_InitStruct.Pin = LCD_D2_Pin;
	HAL_GPIO_Init(PORT_D2, &GPIO_InitStruct);

	GPIO_InitStruct.Pin = LCD_D3_Pin;
	HAL_GPIO_Init(PORT_D3, &GPIO_InitStruct);

	GPIO_InitStruct.Pin = LCD_D4_Pin;
	HAL_GPIO_Init(PORT_D4, &GPIO_InitStruct);

	GPIO_InitStruct.Pin = LCD_D5_Pin;
	HAL_GPIO_Init(PORT_D5, &GPIO_InitStruct);

	GPIO_InitStruct.Pin = LCD_D6_Pin;
	HAL_GPIO_Init(PORT_D6, &GPIO_InitStruct);

	GPIO_InitStruct.Pin = LCD_D7_Pin;
	HAL_GPIO_Init(PORT_D7, &GPIO_InitStruct);


	GPIO_InitStruct.Pin = LCD_WR_Pin;
	HAL_GPIO_Init(LCD_WR_GPIO_Port, &GPIO_InitStruct);

	GPIO_InitStruct.Pin = LCD_RS_Pin;
	HAL_GPIO_Init(LCD_RS_GPIO_Port, &GPIO_InitStruct);

	GPIO_InitStruct.Pin = LCD_CS_Pin;
	HAL_GPIO_Init(LCD_CS_GPIO_Port, &GPIO_InitStruct);

	GPIO_InitStruct.Pin = LCD_RST_Pin;
	HAL_GPIO_Init(LCD_RST_GPIO_Port, &GPIO_InitStruct);

	GPIO_InitStruct.Pin = LCD_RD_Pin;
	HAL_GPIO_Init(LCD_RD_GPIO_Port, &GPIO_InitStruct);

	/*Configure GPIO pins : LCD_RD_Pin LCD_D4_Pin LCD_D5_Pin LCD_D6_Pin 
					   LCD_D7_Pin */

	//(1): Begin function
	//	TFT_LCD_RST(false);
	HAL_Delay(20);
	TFT_LCD_RST(true);
	HAL_Delay(5);

	/*
	//	readRegister8(0x09, 4, iData); 
	writeRegister8(ILI9341_SLEEPOUT, 0);
	HAL_Delay(500);
	//readRegister8(0x09, 4, iData);



	writeRegister8(ILI9341_SOFTRESET, 0);
	HAL_Delay(50);


	writeRegister8(ILI9341_DISPLAYOFF, 0);
	writeRegister8(ILI9341_POWERCONTROL1, 0x23);
	writeRegister8(ILI9341_POWERCONTROL2, 0x10);
	iData[0] = 0x2b; iData[1] = 0x2b; 
	writeRegister16(ILI9341_VCOMCONTROL1, iData);
	writeRegister8(ILI9341_VCOMCONTROL2, 0xC0);
	writeRegister8(ILI9341_MEMCONTROL,ILI9341_MADCTL_MY | ILI9341_MADCTL_BGR);  //ILI9341_MADCTL_MY |   ILI9341_MADCTL_BGR
	writeRegister8(ILI9341_PIXELFORMAT, 0x55);
	iData[0] = 0x1b; iData[1] = 0x00; 
	writeRegister16(ILI9341_FRAMECONTROL, iData);
	writeRegister8(ILI9341_ENTRYMODE, 0x07);
	writeRegister8(ILI9341_SLEEPOUT, 0);
	HAL_Delay(150);
	writeRegister8(ILI9341_DISPLAYON, 0);
	HAL_Delay(500);//ILI9341_INVERTON
	//ILI9341_fillScreen(ILI9341_BLACK);
	HAL_Delay(20);
	*/

	/*

	ILI9341_RST_RESET;
	TM_ILI9341_Delay(20000);
	ILI9341_RST_SET;

	// Delay for RST response */

	//	TM_ILI9341_Delay(20000);
	//	*/
	//	
	//	
	//	/* Software reset */
	//	TM_ILI9341_SendCommand(ILI9341_RESET);
	TFT_LCD_RS(false);
	write8(ILI9341_RESET);
	TFT_LCD_RS(true);
	write8(0);

	//	TM_ILI9341_Delay(50000);
	HAL_Delay(50);
	//	
	//	TM_ILI9341_SendCommand(ILI9341_POWERA);
	TFT_LCD_RS(false);
	write8(ILI9341_POWERA);
	TFT_LCD_RS(true);
	write8(0x39);
	write8(0x2C);
	write8(0x00);
	write8(0x34);
	write8(0x02);

	//	TM_ILI9341_SendCommand(ILI9341_POWERB);
	TFT_LCD_RS(false);
	write8(ILI9341_POWERB);
	TFT_LCD_RS(true);
	write8(0x00);
	write8(0xC1);
	write8(0x30);

	//	TM_ILI9341_SendCommand(ILI9341_DTCA);
	TFT_LCD_RS(false);
	write8(ILI9341_DTCA);
	TFT_LCD_RS(true);
	write8(0x85);
	write8(0x00);
	write8(0x78);


	//	TM_ILI9341_SendCommand(ILI9341_DTCB);
	TFT_LCD_RS(false);
	write8(ILI9341_DTCB);
	TFT_LCD_RS(true);
	write8(0x00);
	write8(0x00);


	//	TM_ILI9341_SendCommand(ILI9341_POWER_SEQ);
	TFT_LCD_RS(false);
	write8(ILI9341_POWER_SEQ);
	TFT_LCD_RS(true);
	write8(0x64);
	write8(0x03);
	write8(0x12);
	write8(0x81);

	writeRegister8(ILI9341_PRC,0x20);

	//	TM_ILI9341_SendCommand(ILI9341_POWER1);
	//	TM_ILI9341_SendData(0x23);
	writeRegister8(ILI9341_POWER1,0x20);
	//	TM_ILI9341_SendCommand(ILI9341_POWER2);
	//	TM_ILI9341_SendData(0x10);
	writeRegister8(ILI9341_POWER2,0x10);
	//	TM_ILI9341_SendCommand(ILI9341_VCOM1);
	TFT_LCD_RS(false);
	write8(ILI9341_VCOM1);
	TFT_LCD_RS(true);
	write8(0x2E);
	write8(0x28);

	//	TM_ILI9341_SendData(0x3E);
	//	TM_ILI9341_SendData(0x28);



	//	TM_ILI9341_SendCommand(ILI9341_VCOM2);
	//	TM_ILI9341_SendData(0x86);
	writeRegister8(ILI9341_VCOM2,0x86);
	//	TM_ILI9341_SendCommand(ILI9341_MAC);
	//	TM_ILI9341_SendData(0x48);
	writeRegister8(ILI9341_MAC,0x48);
	//	TM_ILI9341_SendCommand(ILI9341_PIXEL_FORMAT);
	//	TM_ILI9341_SendData(0x55);
	writeRegister8(ILI9341_PIXEL_FORMAT,0x55);



	//	TM_ILI9341_SendCommand(ILI9341_FRC);
	TFT_LCD_RS(false);
	write8(ILI9341_FRC);
	TFT_LCD_RS(true);
	write8(0x00);
	write8(0x18);

	//	TM_ILI9341_SendData(0x00);
	//	TM_ILI9341_SendData(0x18);
	//	TM_ILI9341_SendCommand(ILI9341_DFC);
	TFT_LCD_RS(false);
	write8(ILI9341_DFC);
	TFT_LCD_RS(true);
	write8(0x08);
	write8(0x82);
	write8(0x27);
	//	TM_ILI9341_SendData(0x08);
	//	TM_ILI9341_SendData(0x82);
	//	TM_ILI9341_SendData(0x27);


	//	TM_ILI9341_SendCommand(ILI9341_3GAMMA_EN);
	//	TM_ILI9341_SendData(0x00);
	writeRegister8(ILI9341_3GAMMA_EN,0x00);


	//	TM_ILI9341_SendCommand(ILI9341_COLUMN_ADDR);
	TFT_LCD_RS(false);
	write8(ILI9341_COLUMN_ADDR);
	TFT_LCD_RS(true);
	write8(0x00);
	write8(0x00);
	write8(0x00);
	write8(0xEF);
	//	TM_ILI9341_SendData(0x00);
	//	TM_ILI9341_SendData(0x00);
	//	TM_ILI9341_SendData(0x00);
	//	TM_ILI9341_SendData(0xEF);

	//	TM_ILI9341_SendCommand(ILI9341_PAGE_ADDR);
	TFT_LCD_RS(false);
	write8(ILI9341_PAGE_ADDR);
	TFT_LCD_RS(true);
	write8(0x00);
	write8(0x00);
	write8(0x01);
	write8(0x3F);
	//	TM_ILI9341_SendData(0x00);
	//	TM_ILI9341_SendData(0x00);
	//	TM_ILI9341_SendData(0x01);
	//	TM_ILI9341_SendData(0x3F);


	//	TM_ILI9341_SendCommand(ILI9341_GAMMA);
	//	TM_ILI9341_SendData(0x01);
	writeRegister8(ILI9341_GAMMA,0x01);

	//	TM_ILI9341_SendCommand(ILI9341_PGAMMA);
	TFT_LCD_RS(false);
	write8(ILI9341_PGAMMA);
	TFT_LCD_RS(true);

	write8(0x0F);
	write8(0x31);
	write8(0x2B);
	write8(0x0C);
	write8(0x0E);
	write8(0x08);
	write8(0x4E);
	write8(0xF1);
	write8(0x37);
	write8(0x07);
	write8(0x10);
	write8(0x03);
	write8(0x0E);
	write8(0x09);
	write8(0x00);


	TFT_LCD_RS(false);
	write8(ILI9341_NGAMMA);
	TFT_LCD_RS(true);

	write8(0x00);
	write8(0x0E);
	write8(0x14);
	write8(0x03);
	write8(0x11);
	write8(0x07);
	write8(0x31);
	write8(0xC1);
	write8(0x48);
	write8(0x08);
	write8(0x0F);
	write8(0x0C);
	write8(0x31);
	write8(0x36);
	write8(0x0F);
	//	TM_ILI9341_SendCommand(ILI9341_SLEEP_OUT);
	TFT_LCD_RS(false);
	write8(ILI9341_SLEEP_OUT);
	TFT_LCD_RS(true);
	write8(0);
	HAL_Delay(1000);

	TFT_LCD_RS(false);
	write8(ILI9341_DISPLAY_ON);
	TFT_LCD_RS(true);
	write8(0);

	TFT_LCD_RS(false);
	write8(ILI9341_GRAM);
	TFT_LCD_RS(true);
	write8(0);

	//	TM_ILI9341_SendCommand(ILI9341_DISPLAY_ON);
	//	TM_ILI9341_SendCommand(ILI9341_GRAM);
	//	
	//	
	/*
		  writeRegister8(0x01, 0);            // software reset
	   HAL_Delay( 50);  // .kbv will power up with ONLY reset, sleep out, display on
		writeRegister8(0x28, 0);            //Display Off
				
					
	  //  0xF6, 3, 0x01, 0x01, 0x00,  //Interface Control needs EXTC=1 MV_EOR=0, TM=0, RIM=0
					static uint8_t Data[3]={0x01, 0x01, 0x00};
					 writeRegisterN(0xF6,Data,3);
				
				
	  //  0xCF, 3, 0x00, 0x81, 0x30,  //Power Control B [00 81 30]
						static uint8_t Data1[3]={0x00, 0x81, 0x30};
					 writeRegisterN(0xCF,Data1,3);
						
						
	  //  0xED, 4, 0x64, 0x03, 0x12, 0x81,    //Power On Seq [55 01 23 01]
							static uint8_t Data2[4]={0x64, 0x03, 0x12, 0x81};
					 writeRegisterN(0xED,Data2,4);
							
							
	  //  0xE8, 3, 0x85, 0x10, 0x78,  //Driver Timing A [04 11 7A]
							static uint8_t Data4[3]={0x85, 0x10, 0x78};
					 writeRegisterN(0xE8,Data4,3);
						
							
	  //  0xCB, 5, 0x39, 0x2C, 0x00, 0x34, 0x02,      //Power Control A [39 2C 00 34 02]
									static uint8_t Data5[5]={0x39, 0x2C, 0x00, 0x34, 0x02};
					 writeRegisterN(0xCB,Data5,5);
							
							
		writeRegister8(0xF7, 0x20);      //Pump Ratio [10]
					
					iData[0] = 0x00; iData[1] = 0x00; 
					writeRegister16(0xEA, iData);   
	   // 0xEA, 2, 0x00, 0x00,        //Driver Timing B [66 00]
									
									
									
		writeRegister8(0xB0, 0x00);      //RGB Signal [00] 
					
					iData[0] = 0x1b; iData[1] = 0x00; 
					writeRegister16(ILI9341_FRAMECONTROL, iData);  

									
	 
		writeRegister8(0xB4,  0x00);      //Inversion Control [02] .kbv NLA=1, NLB=1, NLC=1
		writeRegister8(0xC0,  0x21);      //Power Control 1 [26]
		writeRegister8(0xC1,  0x11);      //Power Control 2 [00]
					
					iData[0] = 0x3C; iData[1] = 0x3F; 
					writeRegister16(0xC5, iData);     
		
		writeRegister8(0xC7,  0xB5);      //VCOM 2 [C0]
		writeRegister8(0x36,  0x48);      //Memory Access [00]
		writeRegister8(0xF2,  0x00);      //Enable 3G [02]
		writeRegister8(0x26,  0x01);      //Gamma Set [01]
					
					
	 //   0xE0, 15, 0x0f, 0x26, 0x24, 0x0b, 0x0e, 0x09, 0x54, 0xa8, 0x46, 0x0c, 0x17, 0x09, 0x0f, 0x07, 0x00,
			 
					static uint8_t Data15[15]={ 0x0f, 0x26, 0x24, 0x0b, 0x0e, 0x09, 0x54, 0xa8, 0x46, 0x0c, 0x17, 0x09, 0x0f, 0x07, 0x00};
					 writeRegisterN(0xE0,Data15,15);
							
	 //   0xE1, 15, 0x00, 0x19, 0x1b, 0x04, 0x10, 0x07, 0x2a, 0x47, 0x39, 0x03, 0x06, 0x06, 0x30, 0x38, 0x0f,
							static uint8_t Data16[15]={ 0x00, 0x19, 0x1b, 0x04, 0x10, 0x07, 0x2a, 0x47, 0x39, 0x03, 0x06, 0x06, 0x30, 0x38, 0x0f};
					 writeRegisterN(0xE1,Data16,15);
					
		writeRegister8(0x11, 0);            //Sleep Out
		HAL_Delay(150);
		writeRegister8(0x29, 0);            //Display On
		writeRegister8(0x3A, 0x55);      //Pixel Format [66]
	*/
}

//***************************************************************************
void ILI9341_setRotation(uint8_t rotate)
{
	switch(rotate)
	{
		case 1:
			rotationNum = 1;
			writeRegister8(ILI9341_MEMCONTROL,ILI9341_MADCTL_MY | ILI9341_MADCTL_BGR);
			break;
		case 2:
			rotationNum = 2;
			writeRegister8(ILI9341_MEMCONTROL,ILI9341_MADCTL_MV |  ILI9341_MADCTL_BGR);
		temp = TFTHEIGHT;
		TFTHEIGHT = TFTWIDTH;
		TFTWIDTH = temp;
			break;
		case 3:
			rotationNum = 3;
			writeRegister8(ILI9341_MEMCONTROL,ILI9341_MADCTL_MX | ILI9341_MADCTL_BGR);
			break;
		case 4:
			rotationNum = 4;
			writeRegister8(ILI9341_MEMCONTROL,ILI9341_MADCTL_MX | ILI9341_MADCTL_MY | ILI9341_MADCTL_MV | ILI9341_MADCTL_BGR);
		temp = TFTHEIGHT;
		TFTHEIGHT = TFTWIDTH;
		TFTWIDTH = temp;
			break;
		default:
			rotationNum = 1;
			writeRegister8(ILI9341_MEMCONTROL,ILI9341_MADCTL_MY | ILI9341_MADCTL_BGR);
			break;
	}
}
//***************************************************************************
void ILI9341_fillRect(uint16_t x, uint16_t y, uint16_t w, uint16_t h, uint16_t color)
{
	uint8_t colrData[2];
	setAddrWindow(x, y, w+x-1, y+h-1);
	TFT_LCD_RS(false);
	write8(0x2c);
	TFT_LCD_RS(true);
	colrData[0] = 0xFF&(color>>8); colrData[1] = 0xFF&color;
	write8_fast(colrData, w*h);
}
//***************************************************************************
void ILI9341_drawPixel(uint16_t x, uint16_t y, uint16_t color)
{
	uint8_t colrData[2];
	setAddrWindow(x, y, TFTWIDTH-1, TFTHEIGHT-1);
	TFT_LCD_RS(false);
	write8(0x2c);
	TFT_LCD_RS(true);
	colrData[0] = 0xFF&(color>>8); colrData[1] = 0xFF&color;
	write8_fast(colrData, 1);
}
//***************************************************************************
void ILI9341_drawCircle(int16_t x0, int16_t y0, int16_t r, uint16_t color)
{
	int16_t f = 1 - r;
	int16_t ddF_x = 1;
	int16_t ddF_y = -2 * r;
	int16_t x = 0;
	int16_t y = r;

	ILI9341_drawPixel(x0  , y0+r, color);
	ILI9341_drawPixel(x0  , y0-r, color);
	ILI9341_drawPixel(x0+r, y0  , color);
	ILI9341_drawPixel(x0-r, y0  , color);

	while (x<y) {
		if (f >= 0) {
			y--;
			ddF_y += 2;
			f += ddF_y;
		}
		x++;
		ddF_x += 2;
		f += ddF_x;

		ILI9341_drawPixel(x0 + x, y0 + y, color);
		ILI9341_drawPixel(x0 - x, y0 + y, color);
		ILI9341_drawPixel(x0 + x, y0 - y, color);
		ILI9341_drawPixel(x0 - x, y0 - y, color);
		ILI9341_drawPixel(x0 + y, y0 + x, color);
		ILI9341_drawPixel(x0 - y, y0 + x, color);
		ILI9341_drawPixel(x0 + y, y0 - x, color);
		ILI9341_drawPixel(x0 - y, y0 - x, color);
	}
}
//***************************************************************************
void ILI9341_drawLine(int16_t x0, int16_t y0, int16_t x1, int16_t y1, uint16_t color)
{
	int16_t steep = abs(y1 - y0) > abs(x1 - x0);
	if (steep) {
		swap(x0, y0);
		swap(x1, y1);
	}

	if (x0 > x1) {
		swap(x0, x1);
		swap(y0, y1);
	}

	int16_t dx, dy;
	dx = x1 - x0;
	dy = abs(y1 - y0);

	int16_t err = dx / 2;
	int16_t ystep;

	if (y0 < y1) {
		ystep = 1;
	} else {
		ystep = -1;
	}

	for (; x0<=x1; x0++) {
		if (steep) {
			ILI9341_drawPixel(y0, x0, color);
		} else {
			ILI9341_drawPixel(x0, y0, color);
		}
		err -= dy;
		if (err < 0) {
			y0 += ystep;
			err += dx;
		}
	}
}	
//***************************************************************************
void ILI9341_drawFastVLine(int16_t x, int16_t y, int16_t h, uint16_t color)
{
	ILI9341_drawLine(x, y, x, y+h-1, color);
}
//***************************************************************************
static void fillCircleHelper(int16_t x0, int16_t y0, int16_t r, uint8_t cornername, int16_t delta, uint16_t color)
{
	int16_t f     = 1 - r;
	int16_t ddF_x = 1;
	int16_t ddF_y = -2 * r;
	int16_t x     = 0;
	int16_t y     = r;

	while (x<y) {
	if (f >= 0) {
	  y--;
	  ddF_y += 2;
	  f     += ddF_y;
	}
	x++;
	ddF_x += 2;
	f     += ddF_x;

	if (cornername & 0x1) {
	  ILI9341_drawFastVLine(x0+x, y0-y, 2*y+1+delta, color);
	  ILI9341_drawFastVLine(x0+y, y0-x, 2*x+1+delta, color);
	}
	if (cornername & 0x2) {
	  ILI9341_drawFastVLine(x0-x, y0-y, 2*y+1+delta, color);
	  ILI9341_drawFastVLine(x0-y, y0-x, 2*x+1+delta, color);
	}
	}
}
//***************************************************************************
void ILI9341_fillCircle(int16_t x0, int16_t y0, int16_t r, uint16_t color)
{
	ILI9341_drawFastVLine(x0, y0-r, 2*r+1, color);
	fillCircleHelper(x0, y0, r, 3, 0, color);
}
//***************************************************************************
void ILI9341_drawFastHLine(int16_t x, int16_t y, int16_t w, uint16_t color)
{
	ILI9341_drawLine(x, y, x+w-1, y, color);
}
//***************************************************************************
void ILI9341_drawTriangle(int16_t x0, int16_t y0, int16_t x1, int16_t y1, int16_t x2, int16_t y2, uint16_t color)
{
	ILI9341_drawLine(x0, y0, x1, y1, color);
	ILI9341_drawLine(x1, y1, x2, y2, color);
	ILI9341_drawLine(x2, y2, x0, y0, color);
}
//***************************************************************************
void ILI9341_fillScreen(uint16_t color)
{
	//ILI9341_fillRect(0, 0, 320, 241, color); //240, 322
	if(rotationNum==1 || rotationNum==3)
	{
		ILI9341_fillRect(0, 0, 240, 322, color);
	}
	else if(rotationNum==2 || rotationNum==4)
	{
		ILI9341_fillRect(0, 0, 320, 241, color);
	}
}
//***************************************************************************
void ILI9341_drawRoundRect(int16_t x, int16_t y, int16_t w, int16_t h, int16_t r, uint16_t color)
{
	// smarter version
	ILI9341_drawFastHLine(x+r  , y    , w-2*r, color); // Top
	ILI9341_drawFastHLine(x+r  , y+h-1, w-2*r, color); // Bottom
	ILI9341_drawFastVLine(x    , y+r  , h-2*r, color); // Left
	ILI9341_drawFastVLine(x+w-1, y+r  , h-2*r, color); // Right
	// draw four corners
	drawCircleHelper(x+r    , y+r    , r, 1, color);
	drawCircleHelper(x+w-r-1, y+r    , r, 2, color);
	drawCircleHelper(x+w-r-1, y+h-r-1, r, 4, color);
	drawCircleHelper(x+r    , y+h-r-1, r, 8, color);
}
//***************************************************************************
static void drawCircleHelper( int16_t x0, int16_t y0, int16_t r, uint8_t cornername, uint16_t color)
{
	int16_t f     = 1 - r;
	int16_t ddF_x = 1;
	int16_t ddF_y = -2 * r;
	int16_t x     = 0;
	int16_t y     = r;

	while (x<y) {
		if (f >= 0) {
			y--;
			ddF_y += 2;
			f     += ddF_y;
		}
		x++;
		ddF_x += 2;
		f     += ddF_x;
		if (cornername & 0x4) {
			ILI9341_drawPixel(x0 + x, y0 + y, color);
			ILI9341_drawPixel(x0 + y, y0 + x, color);
		} 
		if (cornername & 0x2) {
			ILI9341_drawPixel(x0 + x, y0 - y, color);
			ILI9341_drawPixel(x0 + y, y0 - x, color);
		}
		if (cornername & 0x8) {
			ILI9341_drawPixel(x0 - y, y0 + x, color);
			ILI9341_drawPixel(x0 - x, y0 + y, color);
		}
		if (cornername & 0x1) {
			ILI9341_drawPixel(x0 - y, y0 - x, color);
			ILI9341_drawPixel(x0 - x, y0 - y, color);
		}
	}
}
//***************************************************************************

void ILI9341_drawChar(int16_t x, int16_t y, unsigned char c, uint16_t color, uint16_t bg, uint8_t size)
{
	
	
	if((x >= TFTWIDTH)            || // Clip right
     (y >= TFTHEIGHT)           || // Clip bottom
     ((x + 6 * size - 1) < 0) || // Clip left
     ((y + 8 * size - 1) < 0))   // Clip top
    return;

  if(!_cp437 && (c >= 176)) c++; // Handle 'classic' charset behavior

  for (int8_t i=0; i<6; i++ ) {
    uint8_t line;
    if (i == 5) 
      line = 0x0;
    else 
      line = pgm_read_byte(font+((c)*5)+i);
    for (int8_t j = 0; j<8; j++) {
      if (line & 0x1) {
        if (size == 1) // default size
          ILI9341_drawPixel(x+i, y+j, color);
        else {  // big size
          ILI9341_fillRect(x+(i*size), y+(j*size), size, size+1, color);
        } 
      } else if (bg != color) {
        if (size == 1) // default size
          ILI9341_drawPixel(x+i, y+j, bg);
        else {  // big size
          ILI9341_fillRect(x+i*size, y+j*size, size, size+1, bg);
        }
      }
      line >>= 1;
    }
  }
}






void ILI9341_drawCharADA(int16_t x, int16_t y, unsigned char c, uint16_t color, uint16_t bg, uint8_t size,const GFXfont *f)
{
	
	    // Character is assumed previously filtered by write() to eliminate
    // newlines, returns, non-printable characters, etc.  Calling drawChar()
    // directly with 'bad' characters of font may cause mayhem!

    c -= pgm_read_byte(&f->first);
    GFXglyph *glyph  = &(((GFXglyph *)pgm_read_pointer(&f->glyph))[c]);
    uint8_t  *bitmap = (uint8_t *)pgm_read_pointer(&f->bitmap);

    uint16_t bo = pgm_read_word(&glyph->bitmapOffset);
    uint8_t  w  = pgm_read_byte(&glyph->width),
             h  = pgm_read_byte(&glyph->height),
             xa = pgm_read_byte(&glyph->xAdvance);
    int8_t   xo = pgm_read_byte(&glyph->xOffset),
             yo = pgm_read_byte(&glyph->yOffset);
    uint8_t  xx, yy, bits, bit = 0;
    int16_t  xo16, yo16;

    if(size > 1) {
      xo16 = xo;
      yo16 = yo;
    }

    // Todo: Add character clipping here

    // NOTE: THERE IS NO 'BACKGROUND' COLOR OPTION ON CUSTOM FONTS.
    // THIS IS ON PURPOSE AND BY DESIGN.  The background color feature
    // has typically been used with the 'classic' font to overwrite old
    // screen contents with new data.  This ONLY works because the
    // characters are a uniform size; it's not a sensible thing to do with
    // proportionally-spaced fonts with glyphs of varying sizes (and that
    // may overlap).  To replace previously-drawn text when using a custom
    // font, use the getTextBounds() function to determine the smallest
    // rectangle encompassing a string, erase the area with fillRect(),
    // then draw new text.  This WILL infortunately 'blink' the text, but
    // is unavoidable.  Drawing 'background' pixels will NOT fix this,
    // only creates a new set of problems.  Have an idea to work around
    // this (a canvas object type for MCUs that can afford the RAM and
    // displays supporting setAddrWindow() and pushColors()), but haven't
    // implemented this yet.

    for(yy=0; yy<h; yy++) {
      for(xx=0; xx<w; xx++) {
        if(!(bit++ & 7)) {
          bits = pgm_read_byte(&bitmap[bo++]);
        }
        if(bits & 0x80) {
          if(size == 1) {
            ILI9341_drawPixel(x+xo+xx, y+yo+yy, color);
          } else {
            ILI9341_fillRect(x+(xo16+xx)*size, y+(yo16+yy)*size, size, size, color);
          }
        }
        bits <<= 1;
      }
    }

   // End classic vs custom font
	
}
//***************************************************************************
void ILI9341_printText(char text[], int16_t x, int16_t y, uint16_t color, uint16_t bg, uint8_t size)
{
	int16_t offset;
	
	offset = size*8;
	for(uint16_t i=0; i<40 && text[i]!=NULL; i++)
	{
		ILI9341_drawChar(x+(offset*i), y, text[i],color,bg,size);
	}
}

void ILI9341_writeText(char text[], int16_t x, int16_t y, uint16_t color, uint16_t bg, uint8_t size)
{
	int16_t offset;
	
	offset = size*8;
	for(uint16_t i=0; i<40 && text[i]!=NULL; i++)
	{
		ILI9341_drawChar(x+(offset*i), y, text[i],color,bg,size);
	}
}
//***************************************************************************
void ILI9341_fillRoundRect(int16_t x, int16_t y, int16_t w, int16_t h, int16_t r, uint16_t color)
{
	// smarter version
  ILI9341_fillRect(x+r, y, w-2*r, h, color);
  // draw four corners
  fillCircleHelper(x+w-r-1, y+r, r, 1, h-2*r-1, color);
  fillCircleHelper(x+r    , y+r, r, 2, h-2*r-1, color);
}
//***************************************************************************
void ILI9341_drawButton(int16_t x, int16_t y, int16_t w, int16_t h, uint16_t color,bool inverted)
{
	ILI9341_fillRoundRect(x - (w/2), y - (h/2), w, h, min(w,h)/4, color);
  ILI9341_drawRoundRect(x - (w/2), y - (h/2), w, h, min(w,h)/4, color);
}
//***************************************************************************
void ILI9341_printImage(uint16_t x, uint16_t y, uint16_t w, uint16_t h, uint16_t *data)
{
		HAL_GPIO_WritePin(LCD_CS_GPIO_Port, LCD_CS_Pin, GPIO_PIN_RESET);

	setAddrWindow(x, y, w+x-1, h+y-1);
	uint8_t colrData[2];
	TFT_LCD_RS(false);
	write8(0x2c);
	TFT_LCD_RS(true);
	for(uint32_t i=0; i<(w*h);i++)
	{
	//	write8(data[i]>>8);
	//	write8(data[i]);
//		iData2[0] = data[i] << 8;
//		iData2[1] = data[i];
//		writeRegister16(0x2c, iData2);
	colrData[0] = 0xFF&(data[i]>>8); colrData[1] = 0xFF&data[i];
	write8_fast(colrData, 1);
		//write8((data[i]<<8));
	//	write8(data[i]);
  }
	/*for (uint16_t i=0;i<w;i++)
			for (uint16_t j=0;j<h;j++)
					ILI9341_drawPixel(j,i,data[i*w+j]);
		*/
		HAL_GPIO_WritePin(LCD_CS_GPIO_Port, LCD_CS_Pin, GPIO_PIN_SET);
}

void ILI9341_printImage_8(uint16_t x, uint16_t y, uint16_t w, uint16_t h, uint8_t *data)
{
		HAL_GPIO_WritePin(LCD_CS_GPIO_Port, LCD_CS_Pin, GPIO_PIN_RESET);

	setAddrWindow(x, y, w+x-1, h+y-1);
	uint8_t colrData[2];
	TFT_LCD_RS(false);
	write8(0x2c);
	TFT_LCD_RS(true);
	for(uint32_t i=0; i<(w*h);i++)
	{
	//	write8(data[i]>>8);
	//	write8(data[i]);
//		iData2[0] = data[i] << 8;
//		iData2[1] = data[i];
//		writeRegister16(0x2c, iData2);
	//colrData[0] = 0xFF&(data[i]>>8); 
		colrData[0] = 0xFF&data[i];
	write8_fast(colrData, 1);
		//write8((data[i]<<8));
	//	write8(data[i]);
  }
	/*for (uint16_t i=0;i<w;i++)
			for (uint16_t j=0;j<h;j++)
					ILI9341_drawPixel(j,i,data[i*w+j]);
		*/
		HAL_GPIO_WritePin(LCD_CS_GPIO_Port, LCD_CS_Pin, GPIO_PIN_RESET);
}
//***************************************************************************
void ILI9341_sleepIn(void)
{
	writeRegister8(ILI9341_SLEEPIN, 0);
}
//***************************************************************************
void ILI9341_sleepOut(void)
{
	writeRegister8(ILI9341_SLEEPOUT, 0);
}
//***************************************************************************
void ILI9341_displayOff(void)
{
	writeRegister8(ILI9341_DISPLAYOFF, 0);
}
//***************************************************************************
void ILI9341_displayOn(void)
{
	writeRegister8(ILI9341_DISPLAYON, 0);
}
//***************************************************************************
void ILI9341_invertOn(void)
{
	writeRegister8(ILI9341_INVERTON, 0);
}
//***************************************************************************
void ILI9341_invertOff(void)
{
	writeRegister8(ILI9341_INVERTOFF, 0);
}
//***************************************************************************

 void LCD_bnum(uint8_t x, uint8_t y, char c, uint16_t color,uint16_t bgcolor)
{
  uint8_t colrData[2], h,ch,p,mask,bn_h=72,bn_w=40;      
    
     /* 
    lcd_write(CMD,0x2A); //x-??????????
    lcd_write16(x);
    lcd_write16(x+bn_w-1);

    lcd_write(CMD,0x2B);//Y-??????????
    lcd_write16(y);
    lcd_write16(y+bn_h-1);
    */
	setAddrWindow(x,y,x+bn_w-1,y+bn_h-1);
  //  lcd_write(CMD,0x2C);
		HAL_GPIO_WritePin(LCD_CS_GPIO_Port, LCD_CS_Pin, GPIO_PIN_RESET);
	TFT_LCD_RS(false);
	write8(0x2c);
	TFT_LCD_RS(true);

  for(h=0; h<bn_h; h++) // every column of the character
  {
    for (p=0; p<bn_w; p++)  // write the pixels
        {
        ch=_7snum40x72[(c*360)+p*(bn_h/8)+(h/8)];
        if((h%8)==0)
            mask=0x01;
        else if((h%8)==1)
            mask=0x02;
        else if((h%8)==2)
            mask=0x04;
        else if((h%8)==3)
            mask=0x08;
        else if((h%8)==4)
            mask=0x10;
        else if((h%8)==5)
            mask=0x20;
        else if((h%8)==6)
            mask=0x40;
        else if((h%8)==7)
            mask=0x80;
            
        {
        if (ch & mask)
          { 
						colrData[0] = 0xFF&(color>>8); colrData[1] = 0xFF&color;
						write8_fast(colrData, 1);
       //    lcd_write16(color);
          }
              
          else
          {
         //  bgcolor=BLACK;
				//		color = BLACK;
							colrData[0] = 0xFF&(bgcolor>>8); colrData[1] = 0xFF&bgcolor;
						write8_fast(colrData, 1);
        //   lcd_write16(bgcolor);
          }
        }
        }  
  }
		HAL_GPIO_WritePin(LCD_CS_GPIO_Port, LCD_CS_Pin, GPIO_PIN_SET);
}

 void LCD_Char(uint16_t x, uint16_t y, char c, uint16_t color,uint16_t bgcolor,char m)
{
  uint8_t h,ch,p,mask,colrData[2];      
        
	
	setAddrWindow(x+2,y+1,x+2+CHAR_W*m-1,y+1+CHAR_H*m-1);
  //  lcd_write(CMD,0x2C);
		HAL_GPIO_WritePin(LCD_CS_GPIO_Port, LCD_CS_Pin, GPIO_PIN_RESET);
	TFT_LCD_RS(false);
	write8(0x2c);
	TFT_LCD_RS(true);
	
  /*  lcd_write(CMD,0x2A); //x-??????????
    lcd_write16(x+2);
    lcd_write16(x+2+CHAR_W*m-1);

    lcd_write(CMD,0x2B);//Y-??????????
    lcd_write16(y+1);
    lcd_write16(y+1+CHAR_H*m-1);
                   
                        
      lcd_write(CMD,0x2C);
*/

  for (h=0; h<CHAR_H*m; h++) // every column of the character
  {
          ch=FONT8x15[ c-32 ][h/m];
        // ch=FONT8x15[ c-32 ] [CHAR_H-h-1]; //??????? ?? ?????????
        mask = 0x80;
        for (p=0; p<CHAR_W; p++)  // write the pixels
        {
          if (ch & mask)
          { 
          colrData[0] = 0xFF&(color>>8); colrData[1] = 0xFF&color;
						write8_fast(colrData, 1);
           if(m==2)
           { colrData[0] = 0xFF&(color>>8); colrData[1] = 0xFF&color;
						write8_fast(colrData, 1); }
          }
          
          else
          {
          	colrData[0] = 0xFF&(bgcolor>>8); colrData[1] = 0xFF&bgcolor;
						write8_fast(colrData, 1);
           if(m==2)
           { 	colrData[0] = 0xFF&(bgcolor>>8); colrData[1] = 0xFF&bgcolor;
						write8_fast(colrData, 1);}
          }
          mask=mask/2;
        }
  }
			HAL_GPIO_WritePin(LCD_CS_GPIO_Port, LCD_CS_Pin, GPIO_PIN_SET);
}



void put_string(char *str,uint16_t x, uint16_t y,  uint16_t color,uint16_t bgcolor,uint8_t m)
{
uint8_t j;
  j=0;
  while (j<strlen(str))
  {
    LCD_Char(x+j*CHAR_W*m,y,str[j], color,bgcolor,m);
    j++;
  }
}

void numshow(uint8_t num,uint16_t x, uint16_t y,  uint16_t color,uint16_t bgcolor)
{
	uint8_t bn_w=40;
	if (num>99) num=0;
	uint8_t yekan = num % 10;
	uint8_t dahgan = num / 10;
	LCD_bnum(x,y,dahgan,color,bgcolor);
		LCD_bnum(x+bn_w+2,y,yekan,color,bgcolor);
}
void write(char c,uint16_t cursor_x,uint16_t cursor_y,uint8_t textsize,uint16_t textcolor,uint16_t textbgcolor,const GFXfont *gfxFont)
{
if(c == '\n') {
            cursor_x  = 0;
            cursor_y += (int16_t)textsize *
                        (uint8_t)pgm_read_byte(&gfxFont->yAdvance);
        } else if(c != '\r') {
            uint8_t first = pgm_read_byte(&gfxFont->first);
            if((c >= first) && (c <= (uint8_t)pgm_read_byte(&gfxFont->last))) {
                GFXglyph *glyph = &(((GFXglyph *)pgm_read_pointer(
                  &gfxFont->glyph))[c - first]);
                uint8_t   w     = pgm_read_byte(&glyph->width),
                          h     = pgm_read_byte(&glyph->height);
                if((w > 0) && (h > 0)) { // Is there an associated bitmap?
                    int16_t xo = (int8_t)pgm_read_byte(&glyph->xOffset); // sic
//                    if(wrap && ((cursor_x + textsize * (xo + w)) > _width)) {
//                        cursor_x  = 0;
//                        cursor_y += (int16_t)textsize *
//                          (uint8_t)pgm_read_byte(&gfxFont->yAdvance);
//                    }
                    ILI9341_drawCharADA(cursor_x, cursor_y, c, textcolor, textbgcolor, textsize,gfxFont);
                }
                cursor_x += (uint8_t)pgm_read_byte(&glyph->xAdvance) * (int16_t)textsize;
            }
        }
}
	